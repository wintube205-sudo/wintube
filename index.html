<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TubeView â€” Ù…Ø´ØºÙ‘Ù„ ÙŠÙˆØªÙŠÙˆØ¨</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
  :root {
    --red: #ff2d2d;
    --dark: #0a0a0a;
    --card: #111111;
    --border: #1e1e1e;
    --text: #f0f0f0;
    --muted: #666;
    --accent: #ff2d2d;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'Cairo', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* HEADER */
  header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(10,10,10,0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
    height: 70px;
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    color: var(--red);
    letter-spacing: 3px;
    white-space: nowrap;
    text-shadow: 0 0 30px rgba(255,45,45,0.5);
  }

  .logo span { color: var(--text); }

  .search-bar {
    flex: 1;
    display: flex;
    gap: 0;
    max-width: 600px;
  }

  .search-bar input {
    flex: 1;
    background: var(--card);
    border: 1px solid var(--border);
    border-left: none;
    color: var(--text);
    padding: 0.7rem 1.2rem;
    font-family: 'Cairo', sans-serif;
    font-size: 0.95rem;
    outline: none;
    transition: border-color 0.2s;
    border-radius: 0 8px 8px 0;
  }

  .search-bar input:focus { border-color: var(--red); }

  .search-bar button {
    background: var(--red);
    border: none;
    color: white;
    padding: 0 1.5rem;
    cursor: pointer;
    font-size: 1.1rem;
    transition: background 0.2s;
    border-radius: 8px 0 0 8px;
  }

  .search-bar button:hover { background: #cc2424; }

  /* CATEGORIES */
  .categories {
    padding: 1rem 2rem;
    display: flex;
    gap: 0.6rem;
    overflow-x: auto;
    border-bottom: 1px solid var(--border);
    scrollbar-width: none;
  }
  .categories::-webkit-scrollbar { display: none; }

  .cat-btn {
    background: var(--card);
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 0.45rem 1.2rem;
    border-radius: 50px;
    cursor: pointer;
    font-family: 'Cairo', sans-serif;
    font-size: 0.85rem;
    white-space: nowrap;
    transition: all 0.2s;
  }

  .cat-btn:hover, .cat-btn.active {
    background: var(--red);
    border-color: var(--red);
    color: white;
  }

  /* MAIN */
  main { padding: 2rem; }

  .section-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    color: var(--text);
  }

  .section-title::before {
    content: '';
    width: 4px;
    height: 1.3em;
    background: var(--red);
    border-radius: 2px;
    display: inline-block;
  }

  /* GRID */
  .video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .video-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.25s, border-color 0.25s, box-shadow 0.25s;
  }

  .video-card:hover {
    transform: translateY(-4px);
    border-color: var(--red);
    box-shadow: 0 8px 30px rgba(255,45,45,0.15);
  }

  .thumb-wrap {
    position: relative;
    aspect-ratio: 16/9;
    overflow: hidden;
  }

  .thumb-wrap img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s;
  }

  .video-card:hover .thumb-wrap img { transform: scale(1.05); }

  .play-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.25s;
  }

  .video-card:hover .play-overlay { opacity: 1; }

  .play-btn {
    width: 56px;
    height: 56px;
    background: var(--red);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 20px rgba(255,45,45,0.6);
  }

  .play-btn svg { fill: white; margin-right: -2px; }

  .duration {
    position: absolute;
    bottom: 8px;
    left: 8px;
    background: rgba(0,0,0,0.85);
    color: white;
    font-size: 0.75rem;
    padding: 2px 6px;
    border-radius: 4px;
  }

  .card-info { padding: 1rem; }

  .card-title {
    font-size: 0.95rem;
    font-weight: 600;
    line-height: 1.4;
    margin-bottom: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-meta {
    font-size: 0.8rem;
    color: var(--muted);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .channel-name { color: #aaa; font-weight: 600; }

  /* MODAL */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }

  .modal-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  .modal {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    width: 100%;
    max-width: 900px;
    overflow: hidden;
    transform: scale(0.95);
    transition: transform 0.3s;
  }

  .modal-overlay.open .modal { transform: scale(1); }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .modal-title {
    font-size: 1rem;
    font-weight: 600;
    flex: 1;
    margin-left: 1rem;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .close-btn {
    background: var(--border);
    border: none;
    color: white;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    flex-shrink: 0;
  }

  .close-btn:hover { background: var(--red); }

  .iframe-wrap {
    aspect-ratio: 16/9;
    background: #000;
  }

  .iframe-wrap iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .modal-desc {
    padding: 1.2rem 1.5rem;
    max-height: 150px;
    overflow-y: auto;
    font-size: 0.9rem;
    line-height: 1.7;
    color: #bbb;
  }

  /* LOADING & STATES */
  .loading {
    text-align: center;
    padding: 4rem 2rem;
    display: none;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 3px solid var(--border);
    border-top-color: var(--red);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .empty-state {
    text-align: center;
    padding: 5rem 2rem;
    display: none;
  }

  .empty-state .icon { font-size: 4rem; margin-bottom: 1rem; }
  .empty-state p { color: var(--muted); font-size: 1.1rem; }

  /* LOAD MORE */
  .load-more-wrap { text-align: center; margin-top: 2.5rem; }

  .load-more-btn {
    background: transparent;
    border: 1px solid var(--red);
    color: var(--red);
    padding: 0.8rem 3rem;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .load-more-btn:hover {
    background: var(--red);
    color: white;
  }

  /* RESPONSIVE */
  @media (max-width: 600px) {
    header { padding: 0 1rem; gap: 1rem; }
    .logo { font-size: 1.5rem; }
    main { padding: 1rem; }
    .video-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">TUBE<span>VIEW</span></div>
  <div class="search-bar">
    <button onclick="doSearch()">ğŸ”</button>
    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ..." onkeydown="if(event.key==='Enter') doSearch()">
  </div>
</header>

<div class="categories" id="categories">
  <button class="cat-btn active" onclick="searchCategory('trending', this)">ğŸ”¥ Ø±Ø§Ø¦Ø¬</button>
  <button class="cat-btn" onclick="searchCategory('ØªØ¹Ù„ÙŠÙ…', this)">ğŸ“š ØªØ¹Ù„ÙŠÙ…</button>
  <button class="cat-btn" onclick="searchCategory('ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', this)">ğŸ’» ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</button>
  <button class="cat-btn" onclick="searchCategory('Ø±ÙŠØ§Ø¶Ø©', this)">âš½ Ø±ÙŠØ§Ø¶Ø©</button>
  <button class="cat-btn" onclick="searchCategory('Ù…ÙˆØ³ÙŠÙ‚Ù‰', this)">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰</button>
  <button class="cat-btn" onclick="searchCategory('Ø·Ø¨Ø®', this)">ğŸ³ Ø·Ø¨Ø®</button>
  <button class="cat-btn" onclick="searchCategory('Ø³ÙØ±', this)">âœˆï¸ Ø³ÙØ±</button>
  <button class="cat-btn" onclick="searchCategory('Ø£Ù„Ø¹Ø§Ø¨', this)">ğŸ® Ø£Ù„Ø¹Ø§Ø¨</button>
  <button class="cat-btn" onclick="searchCategory('Ø£Ø®Ø¨Ø§Ø±', this)">ğŸ“° Ø£Ø®Ø¨Ø§Ø±</button>
</div>

<main>
  <div class="section-title" id="sectionTitle">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø±Ø§Ø¦Ø¬Ø©</div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
  </div>

  <div class="empty-state" id="emptyState">
    <div class="icon">ğŸ¬</div>
    <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</p>
  </div>

  <div class="video-grid" id="videoGrid"></div>

  <div class="load-more-wrap" id="loadMoreWrap" style="display:none">
    <button class="load-more-btn" onclick="loadMore()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
  </div>
</main>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div class="close-btn" onclick="closeModal()">âœ•</div>
      <div class="modal-title" id="modalTitle"></div>
    </div>
    <div class="iframe-wrap">
      <iframe id="videoFrame" allowfullscreen allow="autoplay; encrypted-media"></iframe>
    </div>
    <div class="modal-desc" id="modalDesc"></div>
  </div>
</div>

<script>
const API_KEY = 'AIzaSyDNK9EJ5IQ2dFLBn1jUk1hslgOwwTBdvJ0';
let nextPageToken = '';
let currentQuery = '';

function formatCount(n) {
  if (!n) return '';
  n = parseInt(n);
  if (n >= 1e6) return (n/1e6).toFixed(1) + 'M';
  if (n >= 1e3) return (n/1e3).toFixed(1) + 'K';
  return n;
}

function formatDuration(iso) {
  if (!iso) return '';
  const match = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
  if (!match) return '';
  const h = parseInt(match[1]||0), m = parseInt(match[2]||0), s = parseInt(match[3]||0);
  if (h) return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  return `${m}:${String(s).padStart(2,'0')}`;
}

function timeAgo(dateStr) {
  const d = new Date(dateStr), now = new Date();
  const diff = Math.floor((now - d) / 1000);
  if (diff < 60) return 'Ø§Ù„Ø¢Ù†';
  if (diff < 3600) return Math.floor(diff/60) + ' Ø¯Ù‚ÙŠÙ‚Ø©';
  if (diff < 86400) return Math.floor(diff/3600) + ' Ø³Ø§Ø¹Ø©';
  if (diff < 2592000) return Math.floor(diff/86400) + ' ÙŠÙˆÙ…';
  if (diff < 31536000) return Math.floor(diff/2592000) + ' Ø´Ù‡Ø±';
  return Math.floor(diff/31536000) + ' Ø³Ù†Ø©';
}

async function fetchVideos(query, pageToken = '', append = false) {
  showLoading(true);
  const grid = document.getElementById('videoGrid');
  if (!append) grid.innerHTML = '';

  try {
    let videoIds = [];
    let newNextToken = '';
    let items = [];

    if (query === 'trending') {
      // Most Popular videos
      const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&chart=mostPopular&regionCode=SA&hl=ar&maxResults=16&pageToken=${pageToken}&key=${API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      if (data.error) throw new Error(data.error.message);
      items = data.items || [];
      newNextToken = data.nextPageToken || '';
    } else {
      const surl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=16&pageToken=${pageToken}&key=${API_KEY}`;
      const sres = await fetch(surl);
      const sdata = await sres.json();
      if (sdata.error) throw new Error(sdata.error.message);
      videoIds = (sdata.items||[]).map(i => i.id.videoId).filter(Boolean);
      newNextToken = sdata.nextPageToken || '';

      if (videoIds.length) {
        const vurl = `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=${videoIds.join(',')}&key=${API_KEY}`;
        const vres = await fetch(vurl);
        const vdata = await vres.json();
        items = vdata.items || [];
      }
    }

    nextPageToken = newNextToken;
    renderCards(items);

    if (!items.length && !append) {
      document.getElementById('emptyState').style.display = 'block';
    }

    document.getElementById('loadMoreWrap').style.display = nextPageToken ? 'block' : 'none';

  } catch (err) {
    console.error(err);
    if (!append) {
      grid.innerHTML = `<div style="color:#ff6b6b;padding:2rem;grid-column:1/-1;text-align:center">âš ï¸ Ø®Ø·Ø£: ${err.message}</div>`;
    }
  }

  showLoading(false);
}

function renderCards(items) {
  const grid = document.getElementById('videoGrid');
  items.forEach(item => {
    const s = item.snippet;
    const thumb = s.thumbnails?.high?.url || s.thumbnails?.medium?.url || '';
    const dur = formatDuration(item.contentDetails?.duration);
    const views = formatCount(item.statistics?.viewCount);
    const ago = timeAgo(s.publishedAt);

    const card = document.createElement('div');
    card.className = 'video-card';
    card.innerHTML = `
      <div class="thumb-wrap">
        <img src="${thumb}" alt="${s.title}" loading="lazy">
        <div class="play-overlay">
          <div class="play-btn">
            <svg width="22" height="22" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          </div>
        </div>
        ${dur ? `<div class="duration">${dur}</div>` : ''}
      </div>
      <div class="card-info">
        <div class="card-title">${s.title}</div>
        <div class="card-meta">
          <span class="channel-name">${s.channelTitle}</span>
          <span>${views ? views + ' Ù…Ø´Ø§Ù‡Ø¯Ø© â€¢ ' : ''}${ago} Ù…Ø¶Øª</span>
        </div>
      </div>
    `;
    card.onclick = () => openModal(item.id, s.title, s.description || '');
    grid.appendChild(card);
  });
}

function openModal(videoId, title, desc) {
  document.getElementById('videoFrame').src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalDesc').textContent = desc;
  document.getElementById('modalOverlay').classList.add('open');
}

function closeModal(e) {
  if (e && e.target !== document.getElementById('modalOverlay') && !e.target.classList.contains('close-btn')) return;
  document.getElementById('modalOverlay').classList.remove('open');
  document.getElementById('videoFrame').src = '';
}

function showLoading(v) {
  document.getElementById('loading').style.display = v ? 'block' : 'none';
  document.getElementById('emptyState').style.display = 'none';
}

function doSearch() {
  const q = document.getElementById('searchInput').value.trim();
  if (!q) return;
  currentQuery = q;
  nextPageToken = '';
  document.getElementById('sectionTitle').textContent = `Ù†ØªØ§Ø¦Ø¬: "${q}"`;
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  fetchVideos(q);
}

function searchCategory(q, btn) {
  currentQuery = q;
  nextPageToken = '';
  document.getElementById('searchInput').value = '';
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const labels = {trending:'Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø±Ø§Ø¦Ø¬Ø©', ØªØ¹Ù„ÙŠÙ…:'ğŸ“š ØªØ¹Ù„ÙŠÙ…', ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§:'ğŸ’» ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', Ø±ÙŠØ§Ø¶Ø©:'âš½ Ø±ÙŠØ§Ø¶Ø©', Ù…ÙˆØ³ÙŠÙ‚Ù‰:'ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰', Ø·Ø¨Ø®:'ğŸ³ Ø·Ø¨Ø®', Ø³ÙØ±:'âœˆï¸ Ø³ÙØ±', Ø£Ù„Ø¹Ø§Ø¨:'ğŸ® Ø£Ù„Ø¹Ø§Ø¨', Ø£Ø®Ø¨Ø§Ø±:'ğŸ“° Ø£Ø®Ø¨Ø§Ø±'};
  document.getElementById('sectionTitle').textContent = labels[q] || q;
  fetchVideos(q);
}

function loadMore() {
  if (nextPageToken) fetchVideos(currentQuery, nextPageToken, true);
}

// Init
currentQuery = 'trending';
fetchVideos('trending');
</script>
</body>
</html>
