<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>WinTube</title>

<style>

body{
background:#0a0a0a;
color:white;
font-family:Arial;
margin:0;
}

header{
background:#111;
padding:15px;
display:flex;
justify-content:space-between;
}

.points{
background:#222;
padding:6px 12px;
border-radius:20px;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
gap:20px;
padding:20px;
}

.card{
background:#141414;
padding:10px;
border-radius:10px;
}

button{
background:#2563eb;
border:none;
padding:10px;
color:white;
border-radius:6px;
cursor:pointer;
}

.admin{
padding:20px;
border-top:1px solid #333;
}

input,select{
padding:10px;
width:100%;
margin-bottom:10px;
background:#111;
color:white;
border:1px solid #333;
}

</style>

</head>

<body>

<header>

<h2>WinTube</h2>

<div class="points">
‚≠ê <span id="points">0</span>
</div>

</header>

<div class="grid" id="movies"></div>

<div class="admin">

<h3>Admin Panel</h3>

<input id="movieTitle" placeholder="movie name">

<input id="movieDrive" placeholder="google drive link">

<button onclick="addMovie()">Upload Movie</button>

<hr>

<h3>Spin</h3>

<button onclick="spin()">Spin</button>

<div id="spin-result"></div>

<hr>

<h3>Withdraw</h3>

<input id="amount" placeholder="points">

<select id="method">

<option>USDT</option>
<option>ZainCash</option>
<option>Asiacell</option>
<option>MasterCard</option>

</select>

<button onclick="withdraw()">Request Withdraw</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"
import { getFirestore,collection,addDoc,getDocs,updateDoc,doc,setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"
import { getAuth,signInAnonymously,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"

const firebaseConfig={
apiKey:"AIzaSyCOV-2qbB6eFEU-myiTjlXbcE-bWhuqLQs",
authDomain:"wintube-8bcaa.firebaseapp.com",
projectId:"wintube-8bcaa",
storageBucket:"wintube-8bcaa.firebasestorage.app",
messagingSenderId:"459173658209",
appId:"1:459173658209:web:d1e5ddf04ecf548cc67420"
}

const app=initializeApp(firebaseConfig)

const db=getFirestore(app)

const auth=getAuth(app)

let uid=null
let points=0

signInAnonymously(auth)

onAuthStateChanged(auth,async(user)=>{

uid=user.uid

const userRef=doc(db,"users",uid)

await setDoc(userRef,{points:0},{merge:true})

loadPoints()

})

async function loadPoints(){

const querySnapshot=await getDocs(collection(db,"users"))

querySnapshot.forEach((docu)=>{

if(docu.id===uid){

points=docu.data().points||0
document.getElementById("points").innerText=points

}

})

}

async function addPoints(p){

points+=p

document.getElementById("points").innerText=points

await updateDoc(doc(db,"users",uid),{points:points})

}

window.spin=function(){

let rewards=[2,4,6,10,20]

let r=rewards[Math.floor(Math.random()*rewards.length)]

addPoints(r)

document.getElementById("spin-result").innerText="You won "+r

}

window.withdraw=async function(){

let amount=parseInt(document.getElementById("amount").value)

if(amount>points)return alert("not enough")

points-=amount

await updateDoc(doc(db,"users",uid),{points:points})

await addDoc(collection(db,"withdraws"),{

user:uid,
amount:amount,
method:document.getElementById("method").value,
status:"pending",
time:Date.now()

})

alert("request sent")

}

window.addMovie=async function(){

let title=document.getElementById("movieTitle").value
let url=document.getElementById("movieDrive").value

await addDoc(collection(db,"movies"),{

title:title,
url:url

})

loadMovies()

}

async function loadMovies(){

let div=document.getElementById("movies")

div.innerHTML=""

const snap=await getDocs(collection(db,"movies"))

snap.forEach((d)=>{

let m=d.data()

let card=document.createElement("div")

card.className="card"

card.innerHTML=`
<h3>${m.title}</h3>
<button onclick="watch('${m.url}')">Watch</button>
`

div.appendChild(card)

})

}

window.watch=function(url){

addPoints(2)

window.open(url)

}

loadMovies()

</script>

</body>
</html>
