<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WinTube</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root {
  --red:#ff2d2d; --dark:#0a0a0a; --card:#111; --border:#1e1e1e;
  --text:#f0f0f0; --muted:#666; --green:#22c55e; --yellow:#f59e0b;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { font-size:16px; }
body {
  background:var(--dark); color:var(--text);
  font-family:'Cairo',sans-serif; min-height:100vh;
  overflow-x:hidden; -webkit-text-size-adjust:100%;
}

/* â•â• HEADER â•â• */
header {
  position:sticky; top:0; z-index:100;
  background:rgba(10,10,10,.97); backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  padding:0 clamp(.75rem,3vw,2rem);
  height:clamp(56px,8vw,70px);
  display:flex; align-items:center; gap:clamp(.6rem,2vw,1.5rem);
}
.logo {
  font-family:'Bebas Neue',sans-serif;
  font-size:clamp(1.3rem,4vw,2rem);
  color:var(--red); letter-spacing:3px; white-space:nowrap;
  text-shadow:0 0 30px rgba(255,45,45,.5); flex-shrink:0;
}
.logo span { color:var(--text); }

.search-bar { flex:1; display:flex; min-width:0; max-width:550px; }
.search-bar input {
  flex:1; min-width:0;
  background:var(--card); border:1px solid var(--border); border-left:none;
  color:var(--text); padding:.6rem clamp(.6rem,2vw,1.2rem);
  font-family:'Cairo',sans-serif; font-size:clamp(.8rem,2.5vw,.9rem);
  outline:none; transition:border-color .2s;
  border-radius:0 8px 8px 0;
}
.search-bar input:focus { border-color:var(--red); }
.search-bar button {
  background:var(--red); border:none; color:#fff;
  padding:0 clamp(.7rem,2vw,1.3rem);
  cursor:pointer; font-size:clamp(.85rem,2.5vw,1rem);
  border-radius:8px 0 0 8px; flex-shrink:0;
}

.user-panel {
  margin-right:auto; display:flex; align-items:center;
  gap:.6rem; background:var(--card); border:1px solid var(--border);
  border-radius:50px; padding:.35rem .8rem; cursor:pointer; flex-shrink:0;
  transition:border-color .2s;
}
.user-panel:hover { border-color:var(--red); }
.user-avatar {
  width:32px; height:32px; border-radius:50%;
  background:linear-gradient(135deg,var(--red),#ff8c00);
  display:flex; align-items:center; justify-content:center;
  font-size:.85rem; font-weight:700; color:#fff; flex-shrink:0;
}
.user-name { font-size:.8rem; font-weight:600; }
.user-pts { font-size:.72rem; color:var(--yellow); }

/* â•â• CATEGORIES â•â• */
.categories {
  padding:.7rem clamp(.75rem,3vw,2rem);
  display:flex; gap:.5rem; overflow-x:auto;
  border-bottom:1px solid var(--border); scrollbar-width:none;
  -webkit-overflow-scrolling:touch;
}
.categories::-webkit-scrollbar { display:none; }
.cat-btn {
  background:var(--card); border:1px solid var(--border); color:var(--muted);
  padding:.38rem clamp(.7rem,2vw,1.1rem);
  border-radius:50px; cursor:pointer; font-family:'Cairo',sans-serif;
  font-size:clamp(.75rem,2vw,.82rem); white-space:nowrap; transition:all .2s;
  -webkit-tap-highlight-color:transparent;
}
.cat-btn:hover,.cat-btn.active { background:var(--red); border-color:var(--red); color:#fff; }

/* â•â• MAIN â•â• */
main { padding:clamp(1rem,3vw,2rem); }
.section-title {
  font-size:clamp(1rem,3vw,1.2rem); font-weight:700;
  margin-bottom:clamp(1rem,3vw,1.5rem);
  display:flex; align-items:center; gap:.8rem;
}
.section-title::before {
  content:''; width:4px; height:1.3em; background:var(--red);
  border-radius:2px; display:inline-block; flex-shrink:0;
}

/* â•â• VIDEO GRID â•â• */
.video-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(min(100%,280px),1fr));
  gap:clamp(.75rem,2vw,1.5rem);
}
.video-card {
  background:var(--card); border:1px solid var(--border);
  border-radius:12px; overflow:hidden; cursor:pointer;
  transition:transform .25s,border-color .25s,box-shadow .25s;
  -webkit-tap-highlight-color:transparent;
}
.video-card:hover { transform:translateY(-4px); border-color:var(--red); box-shadow:0 8px 30px rgba(255,45,45,.15); }
.thumb-wrap { position:relative; aspect-ratio:16/9; overflow:hidden; }
.thumb-wrap img { width:100%; height:100%; object-fit:cover; transition:transform .4s; display:block; }
.video-card:hover .thumb-wrap img { transform:scale(1.05); }
.play-overlay {
  position:absolute; inset:0; background:rgba(0,0,0,.4);
  display:flex; align-items:center; justify-content:center;
  opacity:0; transition:opacity .25s;
}
.video-card:hover .play-overlay { opacity:1; }
/* Always show play icon on touch devices */
@media(hover:none) { .play-overlay { opacity:1; background:rgba(0,0,0,.25); } }
.play-btn {
  width:clamp(42px,8vw,54px); height:clamp(42px,8vw,54px);
  background:var(--red); border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 4px 20px rgba(255,45,45,.6);
}
.play-btn svg { fill:#fff; margin-right:-2px; }
.duration {
  position:absolute; bottom:8px; left:8px;
  background:rgba(0,0,0,.85); color:#fff;
  font-size:.7rem; padding:2px 6px; border-radius:4px;
}
.card-info { padding:clamp(.65rem,2vw,.9rem); }
.card-title {
  font-size:clamp(.82rem,2.2vw,.9rem); font-weight:600;
  line-height:1.4; margin-bottom:.45rem;
  display:-webkit-box; -webkit-line-clamp:2;
  -webkit-box-orient:vertical; overflow:hidden;
}
.card-meta { font-size:clamp(.7rem,1.8vw,.78rem); color:var(--muted); display:flex; justify-content:space-between; flex-wrap:wrap; gap:.2rem; }
.channel-name { color:#aaa; font-weight:600; }

/* â•â• VIDEO MODAL â•â• */
.modal-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,.96); z-index:1000;
  display:flex; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; transition:opacity .3s;
}
.modal-overlay.open { opacity:1; pointer-events:all; }
.modal {
  background:var(--card); border:1px solid var(--border);
  border-radius:0; width:100%; height:100%;
  overflow:hidden; display:flex; flex-direction:column;
  transform:translateY(20px); transition:transform .3s;
}
.modal-overlay.open .modal { transform:translateY(0); }
.modal-header {
  display:flex; align-items:center; gap:.7rem;
  padding:clamp(.5rem,1.5vw,.85rem) clamp(.75rem,2vw,1.3rem);
  border-bottom:1px solid var(--border); flex-shrink:0; flex-wrap:nowrap;
}
.close-btn {
  background:#222; border:none; color:#fff;
  width:34px; height:34px; border-radius:50%; cursor:pointer;
  font-size:1rem; display:flex; align-items:center; justify-content:center;
  flex-shrink:0; transition:background .2s; -webkit-tap-highlight-color:transparent;
}
.close-btn:hover { background:var(--red); }
.modal-title {
  font-size:clamp(.78rem,2vw,.9rem); font-weight:600; flex:1;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap; min-width:0;
}
/* iframe fills ALL remaining height after header */
.iframe-wrap { flex:1; background:#000; min-height:0; position:relative; overflow:hidden; }
.iframe-wrap #ytPlayerContainer { position:absolute; inset:0; width:100%; height:100%; }
.iframe-wrap #ytPlayerContainer iframe { width:100% !important; height:100% !important; border:none; display:block; }
/* pause indicator overlay */
.pause-indicator {
  position:absolute; inset:0; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:1rem;
  background:rgba(0,0,0,.65); opacity:0; pointer-events:none;
  transition:opacity .4s;
}
.pause-indicator.visible { opacity:1; }
.pause-icon { font-size:4rem; }
.pause-label {
  color:#fff; font-family:'Cairo',sans-serif; font-size:1rem;
  background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.2);
  border-radius:50px; padding:.45rem 1.4rem;
}
.modal-desc {
  padding:clamp(.5rem,1.5vw,.8rem) clamp(.75rem,2vw,1.3rem);
  max-height:70px; overflow-y:auto; flex-shrink:0;
  font-size:clamp(.72rem,1.8vw,.83rem); line-height:1.6; color:#999;
  border-top:1px solid var(--border);
}

/* â•â• POINTS COUNTER â•â• */
.points-counter {
  display:flex; align-items:center; gap:.6rem;
  background:rgba(0,0,0,.5); border:1px solid #2a2a2a;
  border-radius:50px; padding:.3rem .8rem .3rem .6rem; flex-shrink:0;
}
.timer-ring { position:relative; width:36px; height:36px; flex-shrink:0; }
.timer-ring svg { transform:rotate(-90deg); }
.ring-bg { fill:none; stroke:#2a2a2a; stroke-width:3; }
.ring-fill { fill:none; stroke-width:3; stroke-linecap:round; stroke-dasharray:101; stroke-dashoffset:0; transition:stroke-dashoffset 1s linear,stroke .4s; }
.timer-num { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:.62rem; font-weight:800; }
.pts-info { text-align:right; }
.pts-label { font-size:.65rem; color:var(--muted); }
.pts-val { font-size:clamp(.9rem,2.5vw,1.05rem); font-weight:800; color:var(--yellow); }
.pts-val.flash { animation:ptsBlink .5s ease; color:var(--green)!important; }
@keyframes ptsBlink{0%,100%{transform:scale(1)}50%{transform:scale(1.35)}}

/* â•â• TOAST â•â• */
.toast {
  position:fixed; top:80px; left:50%;
  transform:translateX(-50%) translateY(-10px);
  background:rgba(255,45,45,.92); color:#fff;
  padding:.5rem 1.2rem; border-radius:50px;
  font-size:clamp(.8rem,2.5vw,.9rem); font-weight:700;
  z-index:9999; opacity:0; pointer-events:none;
  transition:opacity .3s,transform .3s; white-space:nowrap;
}
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* â•â• AUTH MODAL â•â• */
.auth-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,.96); z-index:2000;
  display:flex; align-items:center; justify-content:center;
  padding:1rem; overflow-y:auto;
}
.auth-overlay.hidden { display:none; }
.auth-box {
  background:var(--card); border:1px solid var(--border);
  border-radius:clamp(12px,3vw,20px);
  padding:clamp(1.5rem,5vw,2.5rem);
  width:100%; max-width:380px; text-align:center;
  margin:auto;
}
.auth-logo { font-family:'Bebas Neue',sans-serif; font-size:clamp(2rem,6vw,2.5rem); color:var(--red); letter-spacing:4px; text-shadow:0 0 30px rgba(255,45,45,.5); }
.auth-logo span { color:var(--text); }
.auth-sub { color:var(--muted); font-size:clamp(.8rem,2.2vw,.88rem); margin:.3rem 0 1.2rem; }
.bonus-badge { background:rgba(34,197,94,.1); border:1px solid rgba(34,197,94,.3); border-radius:8px; padding:.5rem; font-size:clamp(.75rem,2vw,.82rem); color:var(--green); margin-bottom:1.1rem; }
.auth-tabs { display:flex; background:#0a0a0a; border-radius:10px; padding:4px; margin-bottom:1.3rem; gap:4px; }
.auth-tab { flex:1; padding:.48rem; border:none; background:transparent; color:var(--muted); font-family:'Cairo',sans-serif; font-size:clamp(.8rem,2.2vw,.88rem); cursor:pointer; border-radius:8px; transition:all .2s; -webkit-tap-highlight-color:transparent; }
.auth-tab.active { background:var(--red); color:#fff; font-weight:600; }
.auth-input {
  width:100%; background:#0a0a0a; border:1px solid var(--border);
  color:var(--text); padding:.75rem 1rem;
  font-family:'Cairo',sans-serif; font-size:clamp(.85rem,2.5vw,.9rem);
  border-radius:10px; outline:none; margin-bottom:.7rem;
  text-align:right; transition:border-color .2s; display:block;
  /* prevent iOS zoom on focus */
  font-size:max(.9rem, 16px);
}
.auth-input:focus { border-color:var(--red); }
.auth-submit {
  width:100%; background:var(--red); border:none; color:#fff;
  padding:.82rem; border-radius:10px;
  font-family:'Cairo',sans-serif;
  font-size:clamp(.9rem,2.5vw,1rem); font-weight:700;
  cursor:pointer; margin-top:.2rem; transition:background .2s;
  -webkit-tap-highlight-color:transparent;
}
.auth-submit:hover { background:#cc2424; }
.auth-submit:disabled { background:#555; cursor:not-allowed; }
.auth-err { color:var(--red); font-size:clamp(.75rem,2vw,.82rem); margin-top:.8rem; min-height:1.4em; line-height:1.4; }

/* â•â• ZERO POINTS â•â• */
.zero-overlay { position:fixed; inset:0; background:rgba(0,0,0,.97); z-index:3000; display:flex; align-items:center; justify-content:center; padding:1rem; opacity:0; pointer-events:none; transition:opacity .4s; }
.zero-overlay.open { opacity:1; pointer-events:all; }
.zero-box { text-align:center; padding:clamp(1.5rem,5vw,3rem) 2rem; }
.zero-icon { font-size:clamp(3.5rem,10vw,5rem); margin-bottom:1rem; }
.zero-title { font-size:clamp(1.3rem,4vw,1.8rem); font-weight:900; margin-bottom:.5rem; }
.zero-sub { color:var(--muted); font-size:clamp(.85rem,2.5vw,.95rem); margin-bottom:2rem; }

/* â•â• STATES â•â• */
.loading { text-align:center; padding:4rem; display:none; }
.spinner { width:48px; height:48px; border:3px solid var(--border); border-top-color:var(--red); border-radius:50%; animation:spin .8s linear infinite; margin:0 auto 1rem; }
@keyframes spin { to { transform:rotate(360deg); } }
.empty-state { text-align:center; padding:5rem 1rem; display:none; }
.empty-state .icon { font-size:4rem; margin-bottom:1rem; }
.empty-state p { color:var(--muted); }
.load-more-wrap { text-align:center; margin-top:2rem; }
.load-more-btn { background:transparent; border:1px solid var(--red); color:var(--red); padding:.72rem 2.5rem; border-radius:8px; font-family:'Cairo',sans-serif; font-size:.95rem; cursor:pointer; transition:all .2s; -webkit-tap-highlight-color:transparent; }
.load-more-btn:hover { background:var(--red); color:#fff; }

/* â•â• RESPONSIVE BREAKPOINTS â•â• */

/* Large desktop (1400px+) */
@media(min-width:1400px) {
  .video-grid { grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); }
}

/* Tablet landscape (900â€“1199px) */
@media(max-width:1199px) {
  .video-grid { grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); }
}

/* Tablet portrait (600â€“899px) */
@media(max-width:899px) {
  .video-grid { grid-template-columns:repeat(2,1fr); }
  .modal { border-radius:12px; }
}

/* Mobile (â‰¤599px) */
@media(max-width:599px) {
  /* Header: stack search below logo+avatar */
  header {
    height:auto; padding:.6rem 1rem;
    flex-wrap:wrap; gap:.5rem;
  }
  .logo { font-size:1.5rem; order:1; }
  .user-panel { order:2; padding:.3rem .6rem; gap:.4rem; }
  .user-name { display:none; }
  .search-bar { order:3; width:100%; max-width:100%; flex:none; }
  .search-bar input { font-size:16px; /* prevent iOS zoom */ border-radius:0 8px 8px 0; }

  /* Categories: smaller pills */
  .categories { padding:.6rem .75rem; gap:.4rem; }
  .cat-btn { font-size:.75rem; padding:.35rem .8rem; }

  main { padding:.75rem; }

  /* Single column grid */
  .video-grid { grid-template-columns:1fr; gap:.75rem; }
  .card-info { padding:.7rem; }

  /* Modal: full screen on mobile */
  .modal-overlay { padding:0; align-items:flex-end; }
  .modal {
    border-radius:16px 16px 0 0;
    max-height:95dvh;
    transform:translateY(20px);
  }
  .modal-overlay.open .modal { transform:translateY(0); }
  .modal-header { padding:.7rem .9rem; gap:.6rem; flex-wrap:nowrap; }
  .modal-title { font-size:.78rem; }
  .modal-desc { max-height:60px; padding:.6rem .9rem; font-size:.75rem; }

  /* Points counter: compact */
  .points-counter { padding:.25rem .6rem .25rem .5rem; gap:.4rem; }
  .timer-ring { width:30px; height:30px; }
  .pts-label { display:none; }
  .pts-val { font-size:.9rem; }

  /* Auth modal */
  .auth-box { padding:1.5rem 1.2rem; border-radius:16px; }
  .auth-logo { font-size:2rem; }

  /* Toast */
  .toast { font-size:.8rem; padding:.45rem 1rem; top:70px; }

  /* Zero points */
  .zero-box { padding:2rem 1rem; }
  .zero-icon { font-size:3.5rem; }
  .zero-title { font-size:1.4rem; }
}

/* Very small phones (â‰¤360px) */
@media(max-width:360px) {
  .logo { font-size:1.3rem; letter-spacing:2px; }
  .video-grid { gap:.6rem; }
  .auth-box { padding:1.2rem 1rem; }
  .auth-tabs .auth-tab { font-size:.78rem; padding:.4rem .2rem; }
}
</style>
</head>
<body>

<!-- AUTH -->
<div class="auth-overlay" id="authOverlay">
  <div class="auth-box">
    <div class="auth-logo">WIN<span>TUBE</span></div>
    <div class="auth-sub">Ø´Ø§Ù‡Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙˆØ§ÙƒØ³Ø¨ Ù†Ù‚Ø§Ø·Ùƒ!</div>
    <div class="bonus-badge">ğŸ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ <strong>100 Ù†Ù‚Ø·Ø©</strong> Ù…Ø¬Ø§Ù†Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
    <div class="auth-tabs">
      <button class="auth-tab active" id="loginTab" onclick="switchTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <button class="auth-tab" id="regTab" onclick="switchTab('reg')">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
    </div>
    <div id="loginForm">
      <input class="auth-input" type="email" id="lEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" autocomplete="email">
      <input class="auth-input" type="password" id="lPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password">
      <button class="auth-submit" id="loginBtn" onclick="doLogin()">Ø¯Ø®ÙˆÙ„ â†</button>
    </div>
    <div id="regForm" style="display:none">
      <input class="auth-input" type="text" id="rName" placeholder="Ø§Ù„Ø§Ø³Ù…" autocomplete="name">
      <input class="auth-input" type="email" id="rEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" autocomplete="email">
      <input class="auth-input" type="password" id="rPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù+)" autocomplete="new-password">
      <button class="auth-submit" id="regBtn" onclick="doRegister()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ â†</button>
    </div>
    <div class="auth-err" id="authErr"></div>
  </div>
</div>

<!-- ZERO POINTS -->
<div class="zero-overlay" id="zeroOverlay">
  <div class="zero-box">
    <div class="zero-icon">ğŸ’¸</div>
    <div class="zero-title">Ù†ÙØ¯Øª Ù†Ù‚Ø§Ø·Ùƒ!</div>
    <div class="zero-sub">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø²ÙŠØ¯. Ø§Ø´Ø­Ù† Ù†Ù‚Ø§Ø·Ùƒ Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±.</div>
    <button class="auth-submit" style="max-width:220px;margin:0 auto;display:block"
      onclick="document.getElementById('zeroOverlay').classList.remove('open')">Ø­Ø³Ù†Ø§Ù‹</button>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="logo">WIN<span>TUBE</span></div>
  <div class="search-bar">
    <button onclick="doSearch()">ğŸ”</button>
    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ..."
      onkeydown="if(event.key==='Enter')doSearch()">
  </div>
  <div class="user-panel" onclick="doSignOut()">
    <div>
      <div class="user-name" id="hName">â€”</div>
      <div class="user-pts">â­ <span id="hPts">0</span> Ù†Ù‚Ø·Ø©</div>
    </div>
    <div class="user-avatar" id="hAvatar">?</div>
  </div>
</header>

<!-- CATEGORIES -->
<div class="categories">
  <button class="cat-btn active" onclick="searchCategory('trending',this)">ğŸ”¥ Ø±Ø§Ø¦Ø¬</button>
  <button class="cat-btn" onclick="searchCategory('ØªØ¹Ù„ÙŠÙ…',this)">ğŸ“š ØªØ¹Ù„ÙŠÙ…</button>
  <button class="cat-btn" onclick="searchCategory('ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§',this)">ğŸ’» ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</button>
  <button class="cat-btn" onclick="searchCategory('Ø±ÙŠØ§Ø¶Ø©',this)">âš½ Ø±ÙŠØ§Ø¶Ø©</button>
  <button class="cat-btn" onclick="searchCategory('Ù…ÙˆØ³ÙŠÙ‚Ù‰',this)">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰</button>
  <button class="cat-btn" onclick="searchCategory('Ø·Ø¨Ø®',this)">ğŸ³ Ø·Ø¨Ø®</button>
  <button class="cat-btn" onclick="searchCategory('Ø³ÙØ±',this)">âœˆï¸ Ø³ÙØ±</button>
  <button class="cat-btn" onclick="searchCategory('Ø£Ù„Ø¹Ø§Ø¨',this)">ğŸ® Ø£Ù„Ø¹Ø§Ø¨</button>
  <button class="cat-btn" onclick="searchCategory('Ø£Ø®Ø¨Ø§Ø±',this)">ğŸ“° Ø£Ø®Ø¨Ø§Ø±</button>
</div>

<!-- MAIN -->
<main>
  <div class="section-title" id="sectionTitle">ğŸ”¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø±Ø§Ø¦Ø¬Ø©</div>
  <div class="loading" id="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>
  <div class="empty-state" id="emptyState"><div class="icon">ğŸ¬</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p></div>
  <div class="video-grid" id="videoGrid"></div>
  <div class="load-more-wrap" id="loadMoreWrap" style="display:none">
    <button class="load-more-btn" onclick="loadMore()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
  </div>
</main>

<!-- VIDEO MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-header">
      <button class="close-btn" onclick="closeModal()">âœ•</button>
      <div class="modal-title" id="modalTitle"></div>
      <div class="points-counter">
        <div class="timer-ring">
          <svg width="38" height="38" viewBox="0 0 38 38">
            <circle class="ring-bg" cx="19" cy="19" r="16"/>
            <circle class="ring-fill" id="ringFill" cx="19" cy="19" r="16" stroke="#22c55e"/>
          </svg>
          <div class="timer-num" id="timerNum" style="color:#22c55e">30</div>
        </div>
        <div class="pts-info">
          <div class="pts-label">Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</div>
          <div class="pts-val" id="modalPts">0 Ù†Ù‚Ø·Ø©</div>
        </div>
      </div>
    </div>
    <div class="iframe-wrap" id="iframeWrap">
      <div id="ytPlayerContainer"></div>
      <div class="pause-indicator" id="pauseIndicator">
        <div class="pause-icon">â¸ï¸</div>
        <div class="pause-label">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù…ØªÙˆÙ‚Ù â€” Ø§Ø³ØªÙ…Ø± Ø¨Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„ÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
      </div>
    </div>
    <div class="modal-desc" id="modalDesc"></div>
  </div>
</div>

<div class="toast" id="toast">+2 Ù†Ù‚Ø·Ø© ğŸ‰</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STEP 1 â€” Load 3 Firebase compat scripts one after another
//           using a promise chain so each finishes before the next
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadScript(src) {
  return new Promise(function(resolve, reject) {
    var s = document.createElement('script');
    s.src = src;
    s.onload  = resolve;
    s.onerror = function() { reject(new Error('Failed to load: ' + src)); };
    document.head.appendChild(s);
  });
}

var FB_VER = '9.23.0';
loadScript('https://www.gstatic.com/firebasejs/' + FB_VER + '/firebase-app-compat.js')
  .then(function() {
    return loadScript('https://www.gstatic.com/firebasejs/' + FB_VER + '/firebase-auth-compat.js');
  })
  .then(function() {
    return loadScript('https://www.gstatic.com/firebasejs/' + FB_VER + '/firebase-firestore-compat.js');
  })
  .then(function() {
    // â”€â”€â”€ ALL 3 scripts loaded, safe to use firebase now â”€â”€â”€
    initApp();
  })
  .catch(function(err) {
    document.getElementById('authErr').textContent = 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Firebase: ' + err.message;
  });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STEP 2 â€” YouTube (no Firebase needed, runs immediately)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var YT_KEY        = 'AIzaSyDNK9EJ5IQ2dFLBn1jUk1hslgOwwTBdvJ0';
var nextPageToken = '';
var currentQuery  = 'trending';

function fmt(n){if(!n)return'';n=+n;return n>=1e6?(n/1e6).toFixed(1)+'M':n>=1e3?(n/1e3).toFixed(1)+'K':String(n);}
function parseDur(iso){if(!iso)return'';var m=iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!m)return'';var h=+m[1]||0,mn=+m[2]||0,s=+m[3]||0;function p(x){return String(x).padStart(2,'0');}return h?h+':'+p(mn)+':'+p(s):mn+':'+p(s);}
function timeAgo(d){var sec=Math.floor((Date.now()-new Date(d))/1000);if(sec<60)return'Ø§Ù„Ø¢Ù†';if(sec<3600)return Math.floor(sec/60)+'Ø¯';if(sec<86400)return Math.floor(sec/3600)+'Ø³';if(sec<2592000)return Math.floor(sec/86400)+'ÙŠ';if(sec<31536000)return Math.floor(sec/2592000)+'Ø´';return Math.floor(sec/31536000)+'Ø³Ù†Ø©';}

function fetchVideos(query, pageToken, append) {
  pageToken=pageToken||''; append=append||false;
  document.getElementById('loading').style.display='block';
  document.getElementById('emptyState').style.display='none';
  var grid=document.getElementById('videoGrid');
  if(!append) grid.innerHTML='';
  var base='https://www.googleapis.com/youtube/v3/';

  function done(items,token){
    nextPageToken=token||'';
    document.getElementById('loading').style.display='none';
    if(items&&items.length){renderCards(items);}
    else if(!append){document.getElementById('emptyState').style.display='block';}
    document.getElementById('loadMoreWrap').style.display=nextPageToken?'block':'none';
  }
  function fail(e){
    document.getElementById('loading').style.display='none';
    if(!append) grid.innerHTML='<div style="color:#ff6b6b;padding:2rem;grid-column:1/-1;text-align:center">âš ï¸ '+e.message+'</div>';
  }

  if(query==='trending'){
    fetch(base+'videos?part=snippet,contentDetails,statistics&chart=mostPopular&regionCode=SA&hl=ar&maxResults=16&pageToken='+pageToken+'&key='+YT_KEY)
      .then(function(r){return r.json();}).then(function(d){if(d.error)throw new Error(d.error.message);done(d.items,d.nextPageToken);}).catch(fail);
  } else {
    fetch(base+'search?part=snippet&q='+encodeURIComponent(query)+'&type=video&maxResults=16&pageToken='+pageToken+'&key='+YT_KEY)
      .then(function(r){return r.json();}). then(function(sd){
        if(sd.error)throw new Error(sd.error.message);
        var ids=(sd.items||[]).map(function(i){return i.id.videoId;}).filter(Boolean);
        if(!ids.length){done([],sd.nextPageToken);return;}
        fetch(base+'videos?part=snippet,contentDetails,statistics&id='+ids.join(',')+'&key='+YT_KEY)
          .then(function(r){return r.json();}).then(function(vd){done(vd.items,sd.nextPageToken);}).catch(fail);
      }).catch(fail);
  }
}

function renderCards(items){
  var grid=document.getElementById('videoGrid');
  items.forEach(function(item){
    var s=item.snippet;
    var th=s.thumbnails&&(s.thumbnails.high||s.thumbnails.medium)?(s.thumbnails.high||s.thumbnails.medium).url:'';
    var d=parseDur(item.contentDetails&&item.contentDetails.duration);
    var vid=typeof item.id==='string'?item.id:(item.id&&item.id.videoId)||'';
    var views=item.statistics&&item.statistics.viewCount?fmt(item.statistics.viewCount)+' Ù…Ø´ â€¢ ':'';
    var card=document.createElement('div');
    card.className='video-card';
    card.innerHTML='<div class="thumb-wrap"><img src="'+th+'" alt="" loading="lazy"><div class="play-overlay"><div class="play-btn"><svg width="22" height="22" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div>'+(d?'<div class="duration">'+d+'</div>':'')+'</div><div class="card-info"><div class="card-title">'+s.title+'</div><div class="card-meta"><span class="channel-name">'+s.channelTitle+'</span><span>'+views+timeAgo(s.publishedAt)+' Ù…</span></div></div>';
    (function(id,t,desc){card.onclick=function(){openModal(id,t,desc);};})(vid,s.title,s.description||'');
    grid.appendChild(card);
  });
}

function doSearch(){var q=document.getElementById('searchInput').value.trim();if(!q)return;currentQuery=q;nextPageToken='';document.getElementById('sectionTitle').textContent='Ù†ØªØ§Ø¦Ø¬: "'+q+'"';document.querySelectorAll('.cat-btn').forEach(function(b){b.classList.remove('active');});fetchVideos(q);}
function searchCategory(q,btn){currentQuery=q;nextPageToken='';document.getElementById('searchInput').value='';document.querySelectorAll('.cat-btn').forEach(function(b){b.classList.remove('active');});btn.classList.add('active');var L={trending:'ğŸ”¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø±Ø§Ø¦Ø¬Ø©',ØªØ¹Ù„ÙŠÙ…:'ğŸ“š ØªØ¹Ù„ÙŠÙ…',ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§:'ğŸ’» ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§',Ø±ÙŠØ§Ø¶Ø©:'âš½ Ø±ÙŠØ§Ø¶Ø©',Ù…ÙˆØ³ÙŠÙ‚Ù‰:'ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰',Ø·Ø¨Ø®:'ğŸ³ Ø·Ø¨Ø®',Ø³ÙØ±:'âœˆï¸ Ø³ÙØ±',Ø£Ù„Ø¹Ø§Ø¨:'ğŸ® Ø£Ù„Ø¹Ø§Ø¨',Ø£Ø®Ø¨Ø§Ø±:'ğŸ“° Ø£Ø®Ø¨Ø§Ø±'};document.getElementById('sectionTitle').textContent=L[q]||q;fetchVideos(q);}
function loadMore(){if(nextPageToken)fetchVideos(currentQuery,nextPageToken,true);}

// Timer ring (safe to call before Firebase)
var CIRCUMFERENCE=101, timerSecs=30, watchTimer=null;
function drawRing(){
  var fill=document.getElementById('ringFill'),num=document.getElementById('timerNum');
  if(!fill||!num)return;
  var frac=timerSecs/30,color=frac>.6?'#22c55e':frac>.3?'#f59e0b':'#ff2d2d';
  fill.style.strokeDashoffset=CIRCUMFERENCE*(1-frac);
  fill.style.stroke=color; num.style.color=color; num.textContent=timerSecs;
}

// Placeholder for openModal â€” real one assigned in initApp
function openModal(vid,title,desc){
  document.getElementById('authOverlay').classList.remove('hidden');
}
function closeModal(){
  clearInterval(watchTimer); watchTimer=null; timerSecs=30; drawRing();
  document.getElementById('modalOverlay').classList.remove('open');
  document.getElementById('ytPlayerContainer').innerHTML='';
}
function switchTab(tab){
  document.getElementById('loginForm').style.display=tab==='login'?'':'none';
  document.getElementById('regForm').style.display=tab==='reg'?'':'none';
  document.getElementById('loginTab').classList.toggle('active',tab==='login');
  document.getElementById('regTab').classList.toggle('active',tab==='reg');
  document.getElementById('authErr').textContent='';
}

// These are safe no-ops until Firebase loads
function doLogin(){document.getElementById('authErr').textContent='Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Firebase...';}
function doRegister(){document.getElementById('authErr').textContent='Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Firebase...';}
function doSignOut(){}

// Start YouTube immediately (doesn't need Firebase)
drawRing();
fetchVideos('trending');


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STEP 3 â€” initApp() called only after all 3 Firebase
//            scripts finish loading (from the promise chain above)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initApp() {
  // Firebase is now 100% ready
  firebase.initializeApp({
    apiKey:            'AIzaSyCOV-2qbB6eFEU-myiTjlXbcE-bWhuqLQs',
    authDomain:        'wintube-8bcaa.firebaseapp.com',
    projectId:         'wintube-8bcaa',
    storageBucket:     'wintube-8bcaa.firebasestorage.app',
    messagingSenderId: '459173658209',
    appId:             '1:459173658209:web:d1e5ddf04ecf548cc67420'
  });

  var auth = firebase.auth();
  var db   = firebase.firestore();

  var DEDUCT_EVERY = 30, EARN_AMT = 2, START_PTS = 100;
  var currentUser = null, userPoints = 0;

  // â”€â”€ Firestore â”€â”€
  function loadPoints(uid, cb){
    db.collection('users').doc(uid).get().then(function(snap){
      if(snap.exists){
        userPoints=snap.data().points!==undefined?snap.data().points:0; cb();
      } else {
        db.collection('users').doc(uid).set({
          name:currentUser.displayName||'Ù…Ø³ØªØ®Ø¯Ù…',email:currentUser.email,
          points:START_PTS,createdAt:firebase.firestore.FieldValue.serverTimestamp()
        }).then(function(){userPoints=START_PTS;cb();});
      }
    }).catch(function(e){console.error(e);userPoints=0;cb();});
  }
  function savePoints(){
    if(!currentUser)return;
    db.collection('users').doc(currentUser.uid).update({points:userPoints}).catch(console.error);
  }

  // â”€â”€ Auth observer â”€â”€
  auth.onAuthStateChanged(function(user){
    if(user){
      currentUser=user;
      loadPoints(user.uid,function(){
        updateHeader();
        document.getElementById('authOverlay').classList.add('hidden');
      });
    } else {
      currentUser=null; userPoints=0; stopTimer();
      document.getElementById('authOverlay').classList.remove('hidden');
    }
  });

  // â”€â”€ Header â”€â”€
  function updateHeader(){
    document.getElementById('hPts').textContent=userPoints;
    var name=currentUser.displayName||currentUser.email.split('@')[0];
    document.getElementById('hName').textContent=name;
    document.getElementById('hAvatar').textContent=name[0].toUpperCase();
  }

  // â”€â”€ Timer â€” only counts while video is PLAYING â”€â”€
  var isPlaying = false;

  function startTimer(){
    stopTimer(); timerSecs=DEDUCT_EVERY; drawRing();
    watchTimer=setInterval(function(){
      if(!isPlaying) return;          // paused â†’ freeze counter
      timerSecs--; drawRing();
      if(timerSecs<=0){
        timerSecs=DEDUCT_EVERY;
        userPoints=userPoints+EARN_AMT;
        savePoints(); updateHeader();
        document.getElementById('modalPts').textContent=userPoints+' Ù†Ù‚Ø·Ø©';
        showToast();
        var pv=document.getElementById('modalPts');
        pv.classList.remove('flash'); void pv.offsetWidth; pv.classList.add('flash');
        setTimeout(function(){pv.classList.remove('flash');},600);
      }
    },1000);
  }
  function stopTimer(){
    clearInterval(watchTimer);watchTimer=null;
    isPlaying=false; timerSecs=DEDUCT_EVERY; drawRing();
  }
  function setPlaying(playing){
    isPlaying=playing;
    document.getElementById('pauseIndicator').classList.toggle('visible',!playing);
  }
  function showToast(){var t=document.getElementById('toast');t.classList.add('show');setTimeout(function(){t.classList.remove('show');},1800);}

  // â”€â”€ YouTube IFrame API â”€â”€
  var ytPlayer = null;
  var ytReadyCbs = [];
  function onYTReady(cb){ if(window.YT&&window.YT.Player){cb();}else{ytReadyCbs.push(cb);} }

  // Load YouTube IFrame API once
  if(!window._ytApiLoading){
    window._ytApiLoading=true;
    window.onYouTubeIframeAPIReady=function(){
      ytReadyCbs.forEach(function(cb){cb();});
      ytReadyCbs=[];
    };
    var ytScript=document.createElement('script');
    ytScript.src='https://www.youtube.com/iframe_api';
    document.head.appendChild(ytScript);
  }

  function createYTPlayer(videoId){
    // destroy old player
    if(ytPlayer){ try{ ytPlayer.destroy(); }catch(e){} ytPlayer=null; }
    // reset container
    var container = document.getElementById('ytPlayerContainer');
    container.innerHTML = '';
    onYTReady(function(){
      ytPlayer = new YT.Player('ytPlayerContainer', {
        videoId: videoId,
        width:   '100%',
        height:  '100%',
        playerVars:{ autoplay:1, rel:0, modestbranding:1, playsinline:1 },
        events:{
          onStateChange: function(e){
            if(e.data === YT.PlayerState.PLAYING){
              setPlaying(true);
            } else {
              setPlaying(false);
            }
          },
          onReady: function(e){ e.target.playVideo(); }
        }
      });
    });
  }

  function errMsg(code){
    var m={'auth/user-not-found':'Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„','auth/wrong-password':'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©',
      'auth/invalid-credential':'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©','auth/email-already-in-use':'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹',
      'auth/invalid-email':'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­','auth/weak-password':'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹',
      'auth/network-request-failed':'ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª','auth/too-many-requests':'Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹'};
    return m[code]||('Ø®Ø·Ø£: '+code);
  }
  function showErr(msg){document.getElementById('authErr').textContent=msg;}
  function setBtn(id,dis,label){var b=document.getElementById(id);b.disabled=dis;b.textContent=label;}

  // â”€â”€ Override the placeholder functions with real Firebase ones â”€â”€
  doLogin = function(){
    var email=document.getElementById('lEmail').value.trim();
    var pass=document.getElementById('lPass').value;
    if(!email||!pass){showErr('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');return;}
    showErr(''); setBtn('loginBtn',true,'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
    auth.signInWithEmailAndPassword(email,pass)
      .catch(function(e){showErr(errMsg(e.code));setBtn('loginBtn',false,'Ø¯Ø®ÙˆÙ„ â†');});
  };

  doRegister = function(){
    var name=document.getElementById('rName').value.trim();
    var email=document.getElementById('rEmail').value.trim();
    var pass=document.getElementById('rPass').value;
    if(!name||!email||!pass){showErr('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');return;}
    if(pass.length<6){showErr('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');return;}
    showErr(''); setBtn('regBtn',true,'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
    auth.createUserWithEmailAndPassword(email,pass)
      .then(function(cred){return cred.user.updateProfile({displayName:name});})
      .catch(function(e){showErr(errMsg(e.code));setBtn('regBtn',false,'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ â†');});
  };

  doSignOut = function(){
    if(!confirm('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ'))return;
    stopTimer(); closeModal(); auth.signOut();
  };

  openModal = function(vid,title,desc){
    if(!currentUser){document.getElementById('authOverlay').classList.remove('hidden');return;}
    document.getElementById('modalTitle').textContent=title;
    document.getElementById('modalDesc').textContent=desc;
    document.getElementById('modalPts').textContent=userPoints+' Ù†Ù‚Ø·Ø©';
    document.getElementById('modalOverlay').classList.add('open');
    setPlaying(false);
    startTimer();
    createYTPlayer(vid);
  };

  closeModal = function(){
    stopTimer();
    document.getElementById('modalOverlay').classList.remove('open');
    document.getElementById('pauseIndicator').classList.remove('visible');
    if(ytPlayer){ try{ ytPlayer.stopVideo(); ytPlayer.destroy(); }catch(e){} ytPlayer=null; }
    document.getElementById('ytPlayerContainer').innerHTML='';
  };
}
</script>
</body>
</html>
